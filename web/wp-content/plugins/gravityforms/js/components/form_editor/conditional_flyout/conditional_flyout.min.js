var GF_CONDITIONAL_INSTANCE=!1,GF_CONDITIONAL_INSTANCES_COLLECTION=[],FOCUSABLE_ELEMENTS=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],TAB_KEY=9,ESCAPE_KEY=27,FOCUSED_BEFORE_DIALOG=null,FOCUSED_BEFORE_RENDER=null;function setFocusToFirstItem(e,t){if(!t||!t.target||gform.tools.getClosest(t.target,"#"+e.id)){var i=getFocusableChildren(e);i.length&&i[0].focus()}}function getFocusableChildren(e){return $$(FOCUSABLE_ELEMENTS.join(","),e).filter(function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)})}function trapTabKey(e,t){var i=getFocusableChildren(e),o=i.indexOf(document.activeElement);t.shiftKey&&0===o?(i[i.length-1].focus(),t.preventDefault()):t.shiftKey||o!==i.length-1||(i[0].focus(),t.preventDefault())}function $$(e,t){return gform.tools.convertElements((t||document).querySelectorAll(e))}function renderView(e,t,i,o){FOCUSED_BEFORE_RENDER=document.activeElement;var n=e;for(var s in i){var l=i[s],a=new RegExp("{{ "+s+" }}","g");n=n.replace(a,l)}return o?(t.innerHTML=n,FOCUSED_BEFORE_RENDER.id&&window.setTimeout(function(){null!=document.getElementById(FOCUSED_BEFORE_RENDER.id)&&document.getElementById(FOCUSED_BEFORE_RENDER.id).focus()},10),!0):n}function getFieldById(t){var e=this.form.fields.filter(function(e){return e.id==t});return!!e.length&&e[0]}function getCorrectDefaultFieldId(e){if(!e)return null;if(!e.inputs||!e.inputs.length)return e.id;var t=e.inputs.filter(function(e){return!e.isHidden});return t.length?t[0].id:e.id}function getOptionsFromSelect(e,t){var i=[],o=gf_vars.emptyChoice;e.placeholder&&(o=e.placeholder);var n={label:o,value:"",selected:""===t?'selected="selected"':""};i.push(n);for(var s=0;s<e.choices.length;s++){var l=e.choices[s],a={label:l.text,value:l.value,selected:l.value==t?'selected="selected"':""};i.push(a)}return i}function getCategoryOptions(e,t){for(var i=gf_vars.conditionalLogic.categories,o=[],n=0;n<i.length;n++){var s=i[n],l={label:s.label,value:s.term_id,selected:s.term_id==t?'selected="selected"':""};o.push(l)}return o}function getAddressOptions(e,t,i){var o=[],n=gf_vars.conditionalLogic.addressOptions;if(!e.inputs)return o;if(!n[e.addressType])return[];var s=n[e.addressType];if(!Array.isArray(s)){for(var l in s)for(var a=s[l],r=0;r<a.length;r++){var d={label:c=a[r],value:c,selected:c==i?'selected="selected"':""};o.push(d)}return o}for(r=0;r<s.length;r++){var c;d={label:c=s[r],value:c,selected:c==i?'selected="selected"':""};o.push(d)}return o}function generateGFConditionalLogic(e,t){GF_CONDITIONAL_INSTANCE&&GF_CONDITIONAL_INSTANCE.fieldId!=e&&GF_CONDITIONAL_INSTANCES_COLLECTION.forEach(function(e,t){e.hideFlyout(),e.removeEventListeners(),e.deactivated=!0}),GF_CONDITIONAL_INSTANCE=new GFConditionalLogic(e,t),(GF_CONDITIONAL_INSTANCES_COLLECTION=GF_CONDITIONAL_INSTANCES_COLLECTION.filter(function(e){return!0!==e.deactivated})).push(GF_CONDITIONAL_INSTANCE)}function isValidFlyoutClick(e){return"jsConditonalToggle"in e.target.dataset||"jsAddRule"in e.target.dataset||"jsDeleteRule"in e.target.dataset||e.target.classList.contains("gform-field__toggle-input")}function ruleNeedsTextValue(e){return-1!==["contains","starts_with","ends_with","<",">"].indexOf(e.operator)}function GFConditionalLogic(e,t){this.fieldId=e,this.form=form,this.objectType=t,this.els=this.gatherElements(),this.state=this.getStateForField(e),this.visible=!1,this._handleToggleClick=this.handleToggleClick.bind(this),this._handleFlyoutChange=this.handleFlyoutChange.bind(this),this._handleBodyClick=this.handleBodyClick.bind(this),this._handleAccordionClick=this.handleAccordionClick.bind(this),this._handleSidebarClick=this.handleSidebarClick.bind(this),this._maintainFocus=this._maintainFocus.bind(this),this._bindKeypress=this._bindKeypress.bind(this),this.init()}GFConditionalLogic.prototype.renderSidebar=function(){var e={title:this.getAccordionTitle(),toggleText:gf_vars.configure+" "+gf_vars.conditional_logic_text,active_class:this.isEnabled()?"gform-status--active":"",active_text:this.isEnabled()?"Active":"Inactive",desc_class:GetFirstRuleField()<=0?"active":"",toggle_class:GetFirstRuleField()<=0?"":"active",desc:gf_vars.conditionalLogic.conditionalLogicHelperText};renderView(gf_vars.conditionalLogic.views.sidebar,this.els[this.objectType],e,!0)},GFConditionalLogic.prototype.renderFlyout=function(){var e={objectType:this.objectType,fieldId:this.fieldId,checked:this.state.enabled?"checked":"",activeClass:this.visible?"active":"inactive",enabledText:this.state.enabled?gf_vars.enabled:gf_vars.disabled,configure:gf_vars.configure,conditionalLogic:gf_vars.conditional_logic_text,enable:gf_vars.enable,desc:gf_vars.conditional_logic_desc,main:this.renderMainControls(!1)};renderView(gf_vars.conditionalLogic.views.flyout,this.els.flyouts[this.objectType],e,!0),gform.tools.trigger("gform_render_simplebars")},GFConditionalLogic.prototype.renderLogicDescription=function(){var e={actionType:this.state.actionType,logicType:this.state.logicType,objectTypeText:this.getObjectTypeText(),objectShowText:this.getObjectShowText(),objectHideText:this.getObjectHideText(),matchText:gf_vars.ofTheFollowingMatch,allText:gf_vars.all,anyText:gf_vars.any,hideSelected:"hide"===this.state.actionType?'selected="selected"':"",showSelected:"show"===this.state.actionType?'selected="selected"':"",allSelected:"all"===this.state.logicType?'selected="selected"':"",anySelected:"any"===this.state.logicType?'selected="selected"':""},t=renderView(gf_vars.conditionalLogic.views.logicDescription,this.els.flyouts[this.objectType],e,!1);return gform.applyFilters("gform_conditional_logic_description",t,[],this.objectType,this)},GFConditionalLogic.prototype.renderMainControls=function(e){var t={enabledClass:this.state.enabled?"active":"",logicDescription:this.renderLogicDescription()},i=gf_vars.conditionalLogic.views.main;if(!e)return renderView(i,this.els.flyouts[this.objectType],t,!1);renderView(i,this.els.flyouts[this.objectType].querySelector(".conditional_logic_flyout__main"),t,!0)},GFConditionalLogic.prototype.renderFieldOptions=function(e){for(var t="",i=gf_vars.conditionalLogic.views.option,o=[],n=0;n<form.fields.length;n++){var s=form.fields[n];if(IsConditionalLogicField(s))if(s.inputs&&-1==jQuery.inArray(GetInputType(s),["checkbox","email","consent"]))for(var l=0;l<s.inputs.length;l++){var a=s.inputs[l];if(!a.isHidden){var r={label:GetLabel(s,a.id),value:a.id,selected:a.id==e.fieldId?'selected="selected"':""};o.push(r)}}else{r={label:GetLabel(s),value:s.id,selected:s.id==e.fieldId?'selected="selected"':""};o.push(r)}}o=gform.applyFilters("gform_conditional_logic_fields",o,form,e.fieldId);for(n=0;n<o.length;n++){(r=o[n]).selected||(r.selected=r.value==e.fieldId?'selected="selected"':""),t+=renderView(i,null,r,!1)}return t},GFConditionalLogic.prototype.renderOperatorOptions=function(e){var t="",i=gf_vars.conditionalLogic.views.option,o={is:gf_vars.is,isnot:gf_vars.isNot,">":gf_vars.greaterThan,"<":gf_vars.lessThan,contains:gf_vars.contains,starts_with:gf_vars.startsWith,ends_with:gf_vars.endsWith};for(key in o=gform.applyFilters("gform_conditional_logic_operators",o,this.objectType,this.fieldId)){t+=renderView(i,null,{label:o[key],value:key,selected:key==e.operator?'selected="selected"':""},!1)}return t},GFConditionalLogic.prototype.renderValueOptions=function(e,t){var i=getFieldById(e.fieldId),o="",n=gf_vars.conditionalLogic.views.option,s=[];-1!==e.fieldId.toString().indexOf(".")&&(i=getFieldById(e.fieldId.split(".")[0]));if(!i&&!IsAddressSelect(e.fieldId,i))return o;IsAddressSelect(e.fieldId,i)&&(s=getAddressOptions(i,e.fieldId,e.value)),i&&"post_category"==i.type&&i.displayAllCategories&&(s=getCategoryOptions(i,e.value)),i&&i.choices&&"post_category"!=i.type&&(s=getOptionsFromSelect(i,e.value));for(var l=0;l<s.length;l++){o+=renderView(n,null,s[l],!1)}return o},GFConditionalLogic.prototype.renderInput=function(e,t){var i={ruleIdx:t,value:e.value};return renderView(gf_vars.conditionalLogic.views.input,null,i,!1)},GFConditionalLogic.prototype.renderSelect=function(e,t){var i={ruleIdx:t,fieldValueOptions:this.renderValueOptions(e,t)};return renderView(gf_vars.conditionalLogic.views.select,null,i,!1)},GFConditionalLogic.prototype.renderRuleValue=function(e,t){var i=this.renderValueOptions(e,t).length,o="",n=ruleNeedsTextValue(e);o=!i||n?this.renderInput(e,t):this.renderSelect(e,t),o=gform.applyFilters("gform_conditional_logic_values_input",o,this.objectType,t,e.fieldId,e.value);var s=gform.tools.htmlToElement(o);return s.classList.contains("active")||s.classList.add("active"),s.hasAttribute("data-js-rule-input")||s.setAttribute("data-js-rule-input","value"),gform.tools.elementToHTML(s)},GFConditionalLogic.prototype.renderRule=function(e,t){getFieldById(e.fieldId);var i={rule_idx:t,fieldOptions:this.renderFieldOptions(e),operatorOptions:this.renderOperatorOptions(e),deleteClass:1<this.state.rules.length?"active":"",value:e.value,valueMarkup:this.renderRuleValue(e,t),addRuleText:gf_vars.conditionalLogic.addRuleText,removeRuleText:gf_vars.conditionalLogic.removeRuleText};return renderView(gf_vars.conditionalLogic.views.rule,null,i,!1)},GFConditionalLogic.prototype.renderRules=function(){for(var e=this.els.flyouts[this.objectType].querySelector(".conditional_logic_flyout__logic"),t="",i=0;i<this.state.rules.length;i++)t+=this.renderRule(this.state.rules[i],i);renderView(t,e,{},!0)},GFConditionalLogic.prototype.gatherElements=function(){return{field:document.querySelector(".conditional_logic_field_setting"),page:document.querySelector(".conditional_logic_page_setting"),next_button:document.querySelector(".conditional_logic_nextbutton_setting"),flyouts:{page:document.getElementById("conditional_logic_flyout_container"),field:document.getElementById("conditional_logic_flyout_container"),next_button:document.getElementById("conditional_logic_next_button_flyout_container")}}},GFConditionalLogic.prototype.getDefaultRule=function(){var e=GetFirstRuleField();return{fieldId:e=getCorrectDefaultFieldId(GetFieldById(e)),operator:"is",value:""}},GFConditionalLogic.prototype.getDefaultState=function(){return{enabled:!1,actionType:"show",logicType:"all",rules:[this.getDefaultRule()]}},GFConditionalLogic.prototype.getStateForField=function(e){var t=getFieldById(e);if(!1===t)return this.getDefaultState();var i="next_button"===this.objectType?t.nextButton.conditionalLogic:t.conditionalLogic;return i&&i.actionType?("enabled"in i||(i.enabled=!0),i):this.getDefaultState()},GFConditionalLogic.prototype.isEnabled=function(){return this.state.enabled&&0<GetFirstRuleField()},GFConditionalLogic.prototype.getAccordionTitle=function(){var e="";switch(this.objectType){case"page":e=gf_vars.page+" ";break;case"next_button":e=gf_vars.next_button+" "}return e+gf_vars.conditional_logic_text},GFConditionalLogic.prototype.getObjectTypeText=function(){switch(this.objectType){case"section":return gf_vars.thisSectionIf;case"field":return gf_vars.thisFieldIf;case"page":return gf_vars.thisPage;case"confirmation":return gf_vars.thisConfirmation;case"notification":return gf_vars.thisNotification;default:return gf_vars.thisFormButton}},GFConditionalLogic.prototype.getObjectShowText=function(){return"next_button"===this.objectType?gf_vars.enable:gf_vars.show},GFConditionalLogic.prototype.getObjectHideText=function(){return"next_button"===this.objectType?gf_vars.disable:gf_vars.hide},GFConditionalLogic.prototype.hideFlyout=function(){var e=this.els.flyouts[this.objectType];e.classList.contains("anim-in-active")&&(e.classList.remove("anim-in-ready"),e.classList.remove("anim-in-active"),e.classList.add("anim-out-ready"),window.setTimeout(function(){e.classList.add("anim-out-active")},25),window.setTimeout(function(){e.classList.remove("anim-out-ready"),e.classList.remove("anim-out-active")},215))},GFConditionalLogic.prototype.showFlyout=function(){for(type in this.els.flyouts){var e=this.els.flyouts[type];e.classList.remove("anim-in-ready"),e.classList.remove("anim-in-active"),e.classList.remove("anim-out-ready"),e.classList.remove("anim-out-active")}var t=this.els.flyouts[this.objectType];t.classList.add("anim-in-ready"),window.setTimeout(function(){t.classList.add("anim-in-active")},25)},GFConditionalLogic.prototype.toggleFlyout=function(e){this.renderFlyout(),this.renderRules(),this.visible?this.hideFlyout():this.showFlyout(),this.visible=!this.visible;var t=this;e&&window.setTimeout(function(){t.handleFocus()},325)},GFConditionalLogic.prototype.updateState=function(e,t){this.state[e]=t,this.updateForm(),"enabled"===e&&(this.renderSidebar(),this.renderMainControls(!0),this.renderRules())},GFConditionalLogic.prototype.updateRule=function(e,t,i){this.state.rules[i][e]=t,this.renderRules(),this.updateForm()},GFConditionalLogic.prototype.addRule=function(){this.state.rules.push(this.getDefaultRule()),this.renderRules(),this.updateForm()},GFConditionalLogic.prototype.deleteRule=function(e){this.state.rules.splice(e,1),this.renderRules(),this.updateForm()},GFConditionalLogic.prototype.updateFormConditionalData=function(e,t){"next_button"!==this.objectType?form.fields[e].conditionalLogic=t:form.fields[e].nextButton.conditionalLogic=t},GFConditionalLogic.prototype.updateForm=function(){for(var e=0;e<form.fields.length;e++){if(form.fields[e].id==this.fieldId)return this.isEnabled()?void this.updateFormConditionalData(e,this.state):void this.updateFormConditionalData(e,"")}},GFConditionalLogic.prototype.handleToggleClick=function(e){(e.target.classList.contains("conditional_logic_accordion__toggle_button")||e.target.classList.contains("conditional_logic_accordion__toggle_button_icon"))&&this.toggleFlyout(!0)},GFConditionalLogic.prototype.handleSidebarClick=function(e){if("jsConditonalToggle"in e.target.dataset&&this.updateState("enabled",e.target.checked),"jsAddRule"in e.target.dataset&&this.addRule(),"jsDeleteRule"in e.target.dataset){var t=gform.tools.getClosest(e.target,"[data-js-rule-idx]");this.deleteRule(t.dataset.jsRuleIdx)}"jsCloseFlyout"in e.target.dataset&&this.toggleFlyout(!0)},GFConditionalLogic.prototype.handleFlyoutChange=function(e){if("jsStateUpdate"in e.target.dataset){var t=e.target.dataset.jsStateUpdate,i=e.target.value;this.updateState(t,i)}if("jsRuleInput"in e.target.dataset){var o=e.target.parentNode;t=e.target.dataset.jsRuleInput,i=e.target.value;this.updateRule(t,i,o.dataset.jsRuleIdx)}},GFConditionalLogic.prototype.handleBodyClick=function(e){isValidFlyoutClick(e)||this.visible&&!this.els.flyouts[this.objectType].contains(e.target)&&this.toggleFlyout(!0)},GFConditionalLogic.prototype.handleAccordionClick=function(e){!this.visible||e.target.classList.contains("conditional_logic_accordion__toggle_button")||e.target.classList.contains("conditional_logic_accordion__toggle_button_icon")||this.toggleFlyout(!1)},GFConditionalLogic.prototype.addEventListeners=function(){this.els[this.objectType].addEventListener("click",this._handleToggleClick),this.els.flyouts[this.objectType].addEventListener("click",this._handleSidebarClick),this.els.flyouts[this.objectType].addEventListener("change",this._handleFlyoutChange),document.body.addEventListener("click",this._handleBodyClick),gform.addAction("formEditorNullClick",this._handleAccordionClick)},GFConditionalLogic.prototype.removeEventListeners=function(){this.els[this.objectType].removeEventListener("click",this._handleToggleClick),this.els.flyouts[this.objectType].removeEventListener("click",this._handleSidebarClick),this.els.flyouts[this.objectType].removeEventListener("change",this._handleFlyoutChange),document.body.removeEventListener("click",this._handleBodyClick)},GFConditionalLogic.prototype._bindKeypress=function(e){this.visible&&e.which===ESCAPE_KEY&&(e.preventDefault(),this.toggleFlyout(!0)),this.visible&&e.which===TAB_KEY&&trapTabKey(this.els.flyouts[this.objectType],e)},GFConditionalLogic.prototype.addFocusToFlyout=function(){FOCUSED_BEFORE_DIALOG=document.activeElement,setFocusToFirstItem(this.els.flyouts[this.objectType]),document.body.addEventListener("focus",this._maintainFocus,!0),document.addEventListener("keydown",this._bindKeypress)},GFConditionalLogic.prototype.removeFocusFromFlyout=function(){FOCUSED_BEFORE_DIALOG&&FOCUSED_BEFORE_DIALOG.focus(),document.body.removeEventListener("focus",this._maintainFocus,!0),document.removeEventListener("keydown",this._bindKeypress)},GFConditionalLogic.prototype.handleFocus=function(){this.visible?this.addFocusToFlyout():this.removeFocusFromFlyout()},GFConditionalLogic.prototype._maintainFocus=function(e){this.visible&&!this.els.flyouts[this.objectType].contains(e.target)&&setFocusToFirstItem(this.els.flyouts[this.objectType],e)},GFConditionalLogic.prototype.render=function(){this.renderSidebar(),this.renderFlyout(),this.renderRules(),this.updateForm()},GFConditionalLogic.prototype.init=function(){this.addEventListeners(),this.renderSidebar()};